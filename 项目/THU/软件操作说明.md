 

 

[TOC]



# 孔洞检测平台软件设计及硬件规格说明文档

## 背景

### 技术背景

激光熔覆技术作为再制造技术中重点发展的激光表面改性技术，在操作过程中能量消耗小，产生的废气、废料少，是国家可持续发展战略中重点发展的先进技术。同时，该技术具有能量集中、加热和冷却速度快、热输入和畸变较小，以及涂层稀释率低等优点，可以获得更加符合设计预期的覆层性能。因此，国内外均投入大量人力、物力进行研究，虽取得了一定的研究成果，但也发现激光熔覆层容易出现气孔、开裂、成分不均匀等缺陷，进而会影响熔覆层的质量，限制了激光熔覆技术的进一步发展。

#### 激光熔覆工艺

LC是一种多学科技术，集成了激光技术、计算机辅助制造技术和控制技术。LC是一个复杂的物理、化学和冶金过程。本节从原理、模拟、监测和参数优化等方面介绍了LC过程的发展现状。

#### 工艺原理

LC使用高功率激光器作为热源，在处理基板上形成熔覆层。根据送粉方式，可分为四种类型：同轴送粉系统、预放置送粉系统、离轴送粉系统和送丝系统。最常用的液相色谱方法是同轴粉末系统和预放置粉末系统。图1是同轴粉末系统和预放置粉末系统的示意图。当粉末被载气从送粉喷嘴喷出时，激光束照射基板以形成液态熔池。在与激光相互作用后，粉末进入液态熔池，并在送粉喷嘴与激光束同步移动时形成熔覆层。与同轴粉末系统不同的是，在预放置粉末系统中，覆层材料预放置在基板上。然后，通过激光束扫描熔化预先放置的粉末，并快速冷却熔池以形成熔覆层。

![img](https://i0.hdslb.com/bfs/article/3fae7f3a6f8d502f514ad1fd06090961f34d8515.png@1256w_576h_!web-article-pic.avif)

### **裂纹产生的原因**

激光熔覆是一个急热急冷的过程，熔覆材料和基材在很短时间内要先熔化成液态，再由液态转变为固态。这个过程中熔覆层因受到外部的拘束而产生内应力，当内应力超过熔覆层的屈服强度时，则产生裂纹。引起裂纹的残余内应力主要有：热应力、组织应力和约束应力，其中对裂纹影响最大的为热应力。

# 软件平台概要介绍



## 激光熔覆气孔检测平台平台设计目标

搭建检测激光熔覆气孔检测平台，主要包括结构光相机、视觉传感器和采集卡等硬件的集成和基于深度学习的检测流程。其中工件点云形貌获取采用ZIVID结构光相机，视觉采用HIK工业相机和镜头；过程中的数字量模拟量采用无线采集卡等，气孔检测算法处理包括点云PCL算法，联合标定，深度和边缘检测，检测模型和分割模型；硬件处理平台和软件处理平台，硬件平台以工控机或笔记本为核心，需要显卡支持；软件处理平台包括前端界面，传感器驱动和算法模块部分。通过构建完整的软硬件系统来进行驱动控制、信号通路、软硬件设备交互、信号获取、传输处理、程序进程分配等，使小车平台能够实时获取传感器信号，并对其处理融合，适配上层算法要求。激光熔覆气孔检测平台能够具备工件3维形貌获取，视觉图像获取，数据存储，孔洞检测，孔洞局部分割，尺寸计算，深度估计等功能。

## 技术方案说明

自动驾驶仿真小车平台的结构原理如图1.1所示。

![image-20240628133541997](.\img\image-20240628133541997.png)

​																				图   平台整体设计

# **平台硬件规格说明**



## 设备架设

小车平台拟采用HUNTER SE，它是一款全能型行业应用UGV，采用模块化、智能化设计，是一款多功能模块化的行业应用移动机器人开发平台，整车大小尺寸符合平台设计要求，载荷和供电能力满足软件平台计算功率需求。车辆性能参数表2.1及结构如图2.3所示。



![image-20240628133947843](.\img\image-20240628133947843.png)

​																				图 HUNTER SE 车体实物图

## HIK工业视觉相机

MV-CA032-10GM/GC进阶型面阵相机，采用Sony的IMX265CMOS芯片，图像质量优异。通过千兆网接口
快速实时传输非压缩数据，最高帧率可达37.5fps。实物图如下图所示，参数如下表。

**功能特性**

- 支持自动或手动调节增益、曝光时间、LUT、Gamma校正等
- 采用千兆网接口，无中继情况下，最大传输距离可到100m
- 128MB板上缓存，可缓存多张图片，用于突发传输或图像重传
- 兼容GigE Vision V2.0协议及GenlCam标准，无缝接入第三方软件平台

![image-20240628135125204](.\img\image-20240628135125204.png)

​														图2.4 MV-CA032-10GM 工业视觉相机实物图

 



| 型号       | 型号                                                         | MV-CA032-10GC                                            |
| ---------- | ------------------------------------------------------------ | -------------------------------------------------------- |
| 名称       | 320万像素网口面阵相机，IMX265，彩色                          |                                                          |
| 性能       | 传感器类型                                                   | CMOS,全局快门                                            |
| 传感器型号 | Sony IMX265                                                  |                                                          |
| 像元尺寸   | 3.45 μm × 3.45 μm                                            |                                                          |
| 靶面尺寸   | 1/1.8”                                                       |                                                          |
| 分辨率     | 2048 × 1536                                                  |                                                          |
| 最大帧率   | 37.5 fps @2048 × 1536 Bayer RG 8                             |                                                          |
| 动态范围   | 73 dB                                                        |                                                          |
| 信噪比     | 40 dB                                                        |                                                          |
| 增益       | 0 dB ~ 20 dB                                                 |                                                          |
| 曝光时间   | 超小曝光模式:1 us ~ 14 us 正常曝光模式:15 us ~ 10 sec        |                                                          |
| 快门模式   | 支持自动曝光、手动曝光、一键曝光模式                         |                                                          |
| 黑白/彩色  | 彩色                                                         |                                                          |
| 像素格式   | Mono 8/10/12 Bayer RG 8/10/10Packed/12/12Packed YUV422Packed,YUV422_YUYV_Packed RGB 8,BGR 8 |                                                          |
| Binning    | 支持1 × 1,1 × 2,1 × 4,2 × 1,2 × 2,2 × 4,4 × 1,4 × 2,4 × 4    |                                                          |
| 下采样     | 支持1 × 1,1 × 2,2 × 1,2 × 2                                  |                                                          |
| 镜像       | 支持水平镜像,垂直镜像                                        |                                                          |
| 电气特性   | 数据接口                                                     | Gigabit Ethernet(1000Mbit/s)兼容Fast Ethernet(100Mbit/s) |
| 数字I/O    | 6-pin P7接头提供供电和I/O:1路光耦隔离输入(Line0),1路光耦隔离输出(Line1),1路双向可配置非隔离I/O(Line2) |                                                          |
| 供电       | 12 VDC,支持PoE供电                                           |                                                          |
| 典型功耗   | 3.5 W@12 VDC                                                 |                                                          |
| 结构       | 镜头接口                                                     | C-Mount                                                  |
| 外形尺寸   | 29 mm × 29 mm × 42 mm                                        |                                                          |
| 重量       | 约68 g                                                       |                                                          |
| IP防护等级 | IP30(正确安装镜头以及线缆的情况下)                           |                                                          |
| 温度       | 工作温度0°C~ 50°C,储藏温度 -30°C~ 70°C                       |                                                          |
| 湿度       | 20% ~ 80%RH无冷凝                                            |                                                          |
| 一般规范   | 软件                                                         | MVS或第三方支持GigE Vision协议软件                       |
| 操作系统   | Windows XP/7/10/11 32/64bits,Linux 32/64bits以及MacOS 64bits |                                                          |
| 协议/标准  | GigE Vision V2.0,GenICam                                     |                                                          |
| 认证       | CE,FCC,RoHS,KC                                               |                                                          |

下图可视化的图像。

![000013](.\img\000013.png)

​																									图 可视化

## **MVL-MF1628M-8MP**镜头

MF系列FA镜头针对机器视觉光源和芯片进行优化设计，分辨率高，成像质量优秀，透过率高，稳定性好。固定焦距，手动光圈，
外形紧凑。可满足机器视觉行业应用，是工业相机的镜头配件，可以在不同采集范围和高度情况下选取不同焦距的镜头。

**功能特性**

- 超高分辨率，画面清晰度一致
- 低畸变，优异的相对照度
- 消色差设计，搭配彩色相机成像更佳
- 高低温稳定性出色，适用于严苛环境
- 微距效果表现优秀，近距离下光学性能出色

![image-20240628135605293](.\img\image-20240628135605293.png)

![image-20240628135658042](.\img\image-20240628135658042.png)



| 型号     | 型号                                                 | MVL-MF1628M-8MP |
| -------- | ---------------------------------------------------- | --------------- |
| 名称     | 16mm，F2.8，2/3"，800万分辨率，C接口镜头             |                 |
| 性能     | 焦距                                                 | 16 mm           |
| F数      | F2.8 ~ F16                                           |                 |
| 像面尺寸 | Φ11 mm(2/3'')                                        |                 |
| 畸变     | 0.33%                                                |                 |
| 最近摄距 | 0.1 m                                                |                 |
| 视场角   | D(11.1 mm):37.39° H(8.45 mm):28.9° V(7.07 mm):24.33° |                 |
| 结构     | 光圈控制                                             | 手动(锁紧结构)  |
| 聚焦控制 | 手动(锁紧结构)                                       |                 |
| 滤镜螺纹 | M27×0.5                                              |                 |
| 接口类型 | C-Mount                                              |                 |
| 法兰后焦 | 17.526 mm                                            |                 |
| 外形尺寸 | Φ28.5×39.33 mm                                       |                 |
| 重量     | 57.1 g                                               |                 |
| 温度     | -10 ~ 50°C                                           |                 |
| 一般规范 | 认证                                                 | RoHS2.0         |

## ZIVID相机

![image-20240628140708643](.\img\image-20240628140708643.png)

![image-20240628140046682](.\img\image-20240628140046682.png)

![image-20240628140055063](.\img\image-20240628140055063.png)

需要注意架设结构光相机时候需要注意合理的倾斜角度和高度，最佳角度在+-10°范围，高度。产品的参数如表2.6所示。

![image-20240628140627934](.\img\image-20240628140627934.png)

# 平台软件操作硬说明

## 启动等待加载

![image-20240628141334119](.\img\image-20240628141334119.png)

## 初始界面

![image-20240628145808815](.\img\image-20240628145808815.png)

## 标定流程

![image-20240628145941638](.\img\image-20240628145941638.png)

![image-20240628145952028](.\img\image-20240628145952028.png)

获得标定结果矩阵

```python
load_rvec: [[0.19368125]
 [0.0694033 ]
 [0.06721855]]
load_tvec: [[-44.33018445]
 [ 46.93888828]
 [-31.0406001 ]]
load_camera_matrix: [[3.91199119e+03 0.00000000e+00 6.40000000e+02]
 [0.00000000e+00 3.91026020e+03 4.80000000e+02]
 [0.00000000e+00 0.00000000e+00 1.00000000e+00]]
load_dist_coeffs: [[-1.24773595e-01]
 [ 1.13793804e+01]
 [ 6.74136432e-04]
 [ 1.80747657e-03]
 [-2.79380404e+02]]
```



## 开始数据采集

![image-20240628145919658](.\img\image-20240628145919658.png)



### 点云的轮廓信息和估计的长短轴信息

同步采集后结构光相机和工业相机都会进行采集

同时后台运行的YOLO和SAM进行会获得检测到的孔洞轮廓和长短轴信息

![image-20240704152944751](E:\codenotes\项目\THU\img\image-20240704152944751.png)

![image-20240704164909048](E:\codenotes\项目\THU\img\image-20240704164909048.png)



> - ==Tips==:现在的SAM检测的时候没有开线程所以会阻塞

![image-20240704173209649](E:\codenotes\项目\THU\img\image-20240704173209649.png)

## HIK工业相机孔洞检测结果

![image-20240628145854307](.\img\image-20240628145854307.png)

## ZIVID相机图像显示

![image-20240628150220077](.\img\image-20240628150220077.png)

## 孔洞局部点云显示

![image-20240628145831227](.\img\image-20240628145831227.png)

## 采集卡控制界面



![image-20240628150303272](.\img\image-20240628150303272.png)

![image-20240628150315961](.\img\image-20240628150315961.png)

![image-20240711211512519](E:\codenotes\项目\THU\img\image-20240711211512519.png)

DAM888需要在共享网络配置IPV4为默认ip

![image-20240711220645943](E:\codenotes\项目\THU\img\image-20240711220645943.png)

调试软件如果不是IP是COM在高级设置中改为TCP



DI电压不稳，测试串口调试软件也不稳

软件：DO是反的现在



## 软件内数据库功能

![image-20240704160710310](E:\codenotes\项目\THU\img\image-20240704160710310.png)

> ==Tips==:现在同步采集最后会添加到数据库信息，但是需要点击保存点云信息和保存海康图像信息，然后双击数据库条目才能加载之前的显示数据

![image-20240704173200527](E:\codenotes\项目\THU\img\image-20240704173200527.png)



# 外部数据库查看数据

![image-20240628150120536](.\img\image-20240628150120536.png)